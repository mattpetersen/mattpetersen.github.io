<!DOCTYPE html>
<html>

<head>

    <!-- meta.html -->
    <!-- Set character encoding for the document -->
    <meta charset="utf-8">
    <!-- Something about IE -->
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <!-- Make the site fit to different screens -->
    <meta name="viewport" content="widh=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- For web crawlers -->
    <meta name="robots" content="index,follow,noodp">  <!-- follow me -->
    <meta name="rating" content="General">  <!-- check my site age -->
    <meta name="subject" content="Deep learning and neural networks">
    <meta name=”description” content=”A blog about deep learning and neural networks”>
    <title>Another MNIST Loader</title> 
    <link rel="stylesheet" type="text/css" href="/css/main.css">
    <!-- end meta.html -->


    <!-- analytics.html -->
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-38506466-1', 'jmcglone.com');
      ga('send', 'pageview');
    </script>
    <!-- end analytics.html -->


    <!-- favicons.html -->
    <!-- For old, favicon.ico in root (16x16, 32x32, 48x48) -->
    <!-- For IE 11, Chrome, Firefox, Safari, Opera -->  
    <link rel="icon" href="/images/favicons/favicon-16.png" sizes="16x16" type="image/png">  
    <link rel="icon" href="/images/favicons/favicon-32.png" sizes="32x32" type="image/png">
    <!-- For phone home screen shortcuts -->
    <link rel="icon" href="/images/favicons/favicon-48.png" sizes="48x48" type="image/png">
    <link rel="icon" href="/images/favicons/favicon-57.png" sizes="57x57" type="image/png">
    <link rel="icon" href="/images/favicons/favicon-62.png" sizes="62x62" type="image/png">
    <link rel="icon" href="/images/favicons/favicon-76.png" sizes="76x76" type="image/png">
    <link rel="icon" href="/images/favicons/favicon-96.png" sizes="96x96" type="image/png">
    <link rel="icon" href="/images/favicons/favicon-120.png" sizes="120x120" type="image/png">
    <link rel="icon" href="/images/favicons/favicon-128.png" sizes="128x128" type="image/png">
    <link rel="icon" href="/images/favicons/favicon-144.png" sizes="144x144" type="image/png">
    <link rel="icon" href="/images/favicons/favicon-152.png" sizes="152x152" type="image/png">
    <link rel="icon" href="/images/favicons/favicon-180.png" sizes="180x180" type="image/png">
    <link rel="icon" href="/images/favicons/favicon-195.png" sizes="195x195" type="image/png">
    <link rel="icon" href="/images/favicons/favicon-196.png" sizes="196x196" type="image/png">
    <link rel="icon" href="/images/favicons/favicon-228.png" sizes="228x228" type="image/png">
    <!-- For windows live tiles -->
    <link rel="icon" href="/images/favicons/smalltile.png" sizes="128x128" type="image/png">
    <link rel="icon" href="/images/favicons/mediumtile.png" sizes="270x270" type="image/png">
    <link rel="icon" href="/images/favicons/widetile.png" sizes="558x270" type="image/png">
    <link rel="icon" href="/images/favicons/largetile.png" sizes="558x558" type="image/png">
    <!--  end favicons.html -->


    <!-- author.html -->
    <link rel="author" href="humans.txt">
    <link rel="me" href="https://twitter.com/mattpetersen_ai" type="text/html">
    <link rel="me" href="mailto:peterm0273@gmail.com">
    <!-- end author.html -->

</head>

<body>

    <!-- header.html -->
    <div class="header">
        <header>
            <nav>
                <ul>
            	   <li><a href="/">Home</a></li>
            	   <li><a href="/about">About</a></li>
                </ul>
            </nav>
        </header>
    </div>
    <!-- end header.html -->


    <!-- post.html -->
    <!-- Import KaTeX (local) -->
    <link rel="stylesheet" type="text/css" href="katex/katex.min.css">
    <script type="text/javascript" src="katex/katex.min.js"></script>
    <!-- Import jQuery (local) -->
    <script type="text/javascript" src="jquery-3.1.1.min.js"></script>
    <!-- Import code-prettify (github) -->
    <script src="https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js"></script>

    <!-- Post header -->
    <h1>Another MNIST Loader</h1>
    <p class="postdate">Posted on July 26, 2017</p>
    <p class="posttags">python, mnist, urllib, numpy, frombuffer </p>
    <hr>

<!-- Post content -->
<p>There are lots of MNIST loaders out there. This one…</p>

<ul>
  <li>Loads straight into Numpy (faster)</li>
  <li>Downloads automatically if missing (easier)</li>
</ul>

<p><strong>Install:</strong></p>

<ul>
  <li><code class="highlighter-rouge">pip install mnist_web</code></li>
</ul>

<p><strong>Usage:</strong></p>

<ul>
  <li><code class="highlighter-rouge">
train_images, train_labels, test_images, test_labels = mnist(path=None, onehot=False)
</code></li>
</ul>

<p><strong>Options:</strong></p>

<ul>
  <li>
    <p>If you leave <code class="highlighter-rouge">path</code> as <code class="highlighter-rouge">None</code>, it defaults to <code class="highlighter-rouge">/home/USER/data/mnist/</code> or the Windows equivalent, which I believe is <code class="highlighter-rouge">C:\Users\USER\data\mnist\</code>.</p>
  </li>
  <li>
    <p>Any of the four MNIST files missing from <code class="highlighter-rouge">path</code> will be downloaded to <code class="highlighter-rouge">path</code>, and it will tell you that’s happening.</p>
  </li>
  <li>
    <p>If you set <code class="highlighter-rouge">onehot</code> to <code class="highlighter-rouge">True</code> then <code class="highlighter-rouge">train_labels</code> and <code class="highlighter-rouge">test_labels</code> will each be a matrix whose rows are onehot labels.</p>
  </li>
</ul>

<p><strong>Speed:</strong></p>

<ul>
  <li>Loads in 0.5 seconds. Downloads and loads in 2.5 seconds.</li>
</ul>

<p><br /></p>
<h2 id="source-code">Source code</h2>

<hr />

<pre class="prettyprint">
"""Load from /home/USER/data/mnist or elsewhere; download if missing."""

import gzip
import os
from urllib.request import urlretrieve

import numpy as np


def mnist(path=None, onehot=False):
    """Return train_images, train_labels, test_images, test_labels.

    :type path: str
    :param path: path to folder containing mnist, default value
                 is /home/USER/data/mnist or Windows equivalent

    :type onehot: bool
    :param onehot: return labels as matrices with onehot rows

    :returns: train_images, train_labels, test_images, test_labels

    Note:
        Downloads to path any mnist files missing from path
    """
    url = 'http://yann.lecun.com/exdb/mnist/'
    files = {'train_images': 'train-images-idx3-ubyte.gz',
             'train_labels': 'train-labels-idx1-ubyte.gz',
             'test_images': 't10k-images-idx3-ubyte.gz',
             'test_labels': 't10k-labels-idx1-ubyte.gz'}

    if path is None:
        # Set path to /home/USER/data/mnist or Windows equivalent
        path = os.path.join(os.path.expanduser('~'), 'data', 'mnist')

    # Create path if it doesn't exist
    os.makedirs(path, exist_ok=True)

    # Download missing files
    for file in files.values():
        if file not in os.listdir(path):
            urlretrieve(''.join((url, file)), os.path.join(path, file))
            print("Downloaded %s to %s" % (file, path))

    def _images(filepath):
        """Return images loaded from path."""
        with gzip.open(filepath) as f:
            # First 16 bytes are magic_number, n_imgs, n_rows, n_cols
            pixels = np.frombuffer(f.read(), 'B', offset=16)
        return pixels.reshape(-1, 784).astype('float32') / 255

    def _labels(filepath, onehot):
        """Return labels loaded from path."""
        def _onehot(integers):
            """Return matrix whose rows are onehot encodings of integers."""
            n_rows = integers.size
            n_cols = integers.max() + 1
            onehot = np.zeros((n_rows, n_cols), dtype='uint8')
            onehot[np.arange(n_rows), integers] = 1
            return onehot

        with gzip.open(filepath) as f:
            # First 8 bytes are magic_number, n_labels
            integer_labels = np.frombuffer(f.read(), 'B', offset=8)

        if onehot:
            return _onehot(integer_labels)
        else:
            return integer_labels

    train_images = _images(os.path.join(path, files['train_images']))
    train_labels = _labels(os.path.join(path, files['train_labels']), onehot)
    test_images = _images(os.path.join(path, files['test_images']))
    test_labels = _labels(os.path.join(path, files['test_labels']), onehot)

    return train_images, train_labels, test_images, test_labels
</pre>

<hr />

<p><br /></p>



<!-- disqus.html -->
<div id="disqus_thread">
    <script>
        /* Change these variables */
        var disqus_config = function () {
            this.page.url = 'https://mattpetersen.github.io/';
            this.page.identifier = "Another MNIST Loader";
        };
        /* Don't edit below this line */
        (function() {
            var d = document, s = d.createElement('script');
            s.src = 'https://mattpetersen-github-io.disqus.com/embed.js';
            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
        })();
    </script>

    <noscript>
        Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
    </noscript>
</div>
<!-- end disqus.html -->



<script>
$("script[type='math/tex']").replaceWith(
  function(){
    var tex = $(this).text();
    return "<span class=\"inline-equation\">" + 
           katex.renderToString(tex) +
           "</span>";
});

$("script[type='math/tex; mode=display']").replaceWith(
  function(){
    var tex = $(this).text();
    return "<div class=\"equation\">" + 
           katex.renderToString("\\displaystyle "+tex) +
           "</div>";
});
</script>

<script>
    txlist = document.getElementsByTagName("dtex");
    for (var i = 0; i < txlist.length; i++) {
        var tx = txlist[i];
        var txtext = "\\displaystyle " + tx.textContent;
        var html = katex.renderToString(txtext, tx, { displayMode: true });
        html = "<div class='equation'>" + html 
                   + "<span style='float:right'>(" + (i+1) + ")</span></div>";
        tx.innerHTML = html;
    }
</script>

<!-- /post.html -->



    <!-- footer.html -->
    <div class="footer">
        <footer>
          <hr> <!-- Horizontal rule -->
          <ul> <!-- Links to my other sites -->
      	      <li><a href="mailto:peterm0273@gmail.com"
                     title="peterm0273@gmail.com">email</a></li>
      	      <li><a href="https://github.com/mattpetersen"
                     title="github.com/mattpetersen">github</a></li>
      	      <li><a href="https://twitter.com/mattpetersen_ai"
                     title="twitter.com/mattpetersen_ai">twitter</a></li>
          </ul>
        </footer>
    </div>
    <!-- end footer.html -->


</html>
